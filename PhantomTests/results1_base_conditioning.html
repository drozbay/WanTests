<!DOCTYPE html>
<html lang="en">
<head>
    <style>
        .nav-header {
            background: #1a1a1a;
            border-bottom: 1px solid #333;
            margin-bottom: 30px;
        }
        .nav-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .nav-brand {
            font-size: 1.2em;
            font-weight: bold;
            color: #667eea;
            text-decoration: none;
        }
        .nav-links {
            display: flex;
            gap: 20px;
        }
        .nav-links a {
            color: #aaa;
            text-decoration: none;
            transition: color 0.3s;
        }
        .nav-links a:hover, .nav-links a.active {
            color: #667eea;
        }
    </style>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phantom Conditioning Test Results</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: #0a0a0a;
            color: #e0e0e0;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            padding: 40px 0;
            border-bottom: 1px solid #333;
            margin-bottom: 40px;
        }
        
        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .intro-section {
            background: #1a1a1a;
            border-radius: 10px;
            padding: 30px;
            margin-bottom: 40px;
            border: 1px solid #333;
        }
        
        .workflow-image {
            width: 100%;
            max-width: 1200px;
            margin: 20px auto;
            display: block;
            border-radius: 8px;
            border: 1px solid #333;
        }
        
        .workflow-placeholder {
            background: #252525;
            padding: 100px 20px;
            text-align: center;
            color: #666;
            border-radius: 8px;
            border: 2px dashed #444;
            margin: 20px 0;
        }
        
        .intro-text {
            margin-top: 20px;
            font-size: 1.1em;
            line-height: 1.8;
        }
        
        .test-grid {
            display: grid;
            gap: 30px;
            margin-bottom: 40px;
        }
        
        .test-card {
            background: #1a1a1a;
            border-radius: 10px;
            padding: 20px;
            border: 1px solid #333;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .test-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.2);
        }
        
        .test-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .test-number {
            font-size: 1.2em;
            font-weight: bold;
            color: #667eea;
        }
        
        .test-speed {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 600;
            background: #2a2a2a;
            border: 1px solid #444;
            color: #aaa;
        }
        
        .test-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .detail-item {
            background: #252525;
            padding: 10px;
            border-radius: 6px;
        }
        
        .detail-label {
            font-size: 0.85em;
            color: #888;
            margin-bottom: 5px;
        }
        
        .detail-value {
            font-weight: 600;
            color: #e0e0e0;
            font-size: 0.95em;
        }
        
        .video-container {
            margin-top: 15px;
            border-radius: 8px;
            overflow: hidden;
            background: #000;
        }
        
        .video-placeholder {
            aspect-ratio: 16/9;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #252525;
            color: #666;
            font-size: 1.2em;
        }
        
        video {
            width: 100%;
            height: auto;
            display: block;
        }
        
        .results-notes {
            margin-top: 15px;
            padding: 15px;
            background: #252525;
            border-radius: 6px;
            border-left: 3px solid #667eea;
        }
        
        .filter-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        
        .filter-btn {
            padding: 8px 20px;
            border: 1px solid #667eea;
            background: transparent;
            color: #667eea;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .filter-btn:hover, .filter-btn.active {
            background: #667eea;
            color: white;
        }
        
        @media (max-width: 768px) {
            .test-details {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="nav-header">
        <div class="nav-container">
            <a href="../index.html" class="nav-brand">WanTests</a>
            <div class="nav-links">
                <a href="results1_base_conditioning.html" class="active">Baseline Conditioning Tests</a>
                <a href="results2_distill_loras.html">Distillation & LoRA Tests</a>
            </div>
        </div>
    </nav>
    <div class="container">
        <header>
            <h1>Phantom Conditioning Test Results</h1>
            <p>Testing conditioning strategies for WanPhantom Subject-to-Video model</p>
            <p style="font-size: 0.9em; color: #aaa;">Last Updated: 2025-08-19</p>
        </header>
        
        <div class="intro-section">
            <h2>Test Motivation</h2>
            <img src="assets/results1/workflow_1.png" alt="ComfyUI Workflow" class="workflow-image">
            <div class="intro-text">
                <p>The WanPhantom Subject-to-Video model outputs three conditioning types: positive (text+image), negative_text (image-only with negative text), and negative_img_text (negative text with zeroed image embeddings). The paper describes a hierarchical dual-CFG approach using all three conditionings with specific weights (7.5 for text, 3.0 for image guidance).</p>
                <p><em>The full ComfyUI node workflow used for these tests is embedded in the PNG image above.</em></p>
                
                <p>These tests explore different conditioning combinations to find the optimal approach for balancing subject resemblance with prompt following. Testing includes the paper's recommended Dual CFG setup, standard CFG with various negative conditioning choices, and the empirically discovered ConditioningCombine approach that merges the two negative outputs.</p>
                
                <p>All tests use the same reference image, prompt ("A woman with blue eyes..."), and seed for direct comparison. Generation speeds vary significantly between approaches due to the number of conditioning passes required.</p>

                <p>More tests will be added including using quality and step-distill loras.</p>
            </div>
        </div>
        
        <div class="filter-controls">
            <button class="filter-btn active" onclick="filterTests('all')">All Tests</button>
            <button class="filter-btn" onclick="filterTests('dual')">Dual CFG</button>
            <button class="filter-btn" onclick="filterTests('standard')">Standard CFG</button>
            <button class="filter-btn" onclick="filterTests('fast')">Faster Methods</button>
        </div>
        
        <div class="test-grid" id="testGrid">
            <!-- Tests will be inserted here by JavaScript -->
        </div>
    </div>
    
    <script>
        // Test data with expanded notes from Discord discussion
        const testData = [
            {
                id: "00005",
                filename: "WanPhantom_Test_00005",
                condition: "Dual CFG, regular",
                cfg: "cond: 7.5, cond2_neg: 3.0",
                sampler: "euler, eta=0.0",
                speed: "Slowest (3 passes)",
                results: "Paper's recommended weights. Mediocre video quality with poor resemblance. Severe over-following of prompt - 'blue eyes' instruction causes unnatural glowing blue eyes effect. This demonstrates the over-guidance issue when using the theoretical weights from the paper. The harsh artifacts suggest the guidance scales are too aggressive for practical use.",
                videoUrl: "assets/results1/WanPhantom_Test_00005.mp4"
            },
            {
                id: "00006",
                filename: "WanPhantom_Test_00006",
                condition: "P: positive, N: negative_text",
                cfg: "cfg: 3.5",
                sampler: "euler, eta=0.0",
                speed: "Fast (2 passes)",
                results: "Standard CFG using only negative_text (which includes image embeddings). Good video quality but noticeably worse resemblance - only captures superficial characteristics. This confirms that using only the image-conditioned negative loses the unconditional baseline needed for proper guidance.",
                videoUrl: "assets/results1/WanPhantom_Test_00006.mp4"
            },
            {
                id: "00007",
                filename: "WanPhantom_Test_00007",
                condition: "P: positive, N: CondCombine (negative_text + negative_img_text)",
                cfg: "cfg: 3.5",
                sampler: "euler, eta=0.0",
                speed: "Fast (2 passes)",
                results: "Empirically discovered approach combining both negative outputs. Achieves good video quality and good resemblance to both person and clothing. Despite not making theoretical sense (combining image-only and unconditional), this produces the most balanced results. 30% faster than Dual CFG methods.",
                videoUrl: "assets/results1/WanPhantom_Test_00007.mp4"
            },
            {
                id: "00008",
                filename: "WanPhantom_Test_00008",
                condition: "Dual CFG, regular",
                cfg: "cond: 3.0, cond2_neg: 1.5",
                sampler: "euler, eta=0.0",
                speed: "Slowest (3 passes)",
                results: "Reduced weights attempting to fix over-guidance. Good video quality but only mediocre resemblance to person and clothing. Better than paper weights but still underperforms CondCombine method despite being more computationally expensive.",
                videoUrl: "assets/results1/WanPhantom_Test_00008.mp4"
            },
            {
                id: "00009",
                filename: "WanPhantom_Test_00009",
                condition: "Dual CFG, nested",
                cfg: "cond: 3.0, cond2_neg: 1.5",
                sampler: "euler, eta=0.0",
                speed: "Slowest (3 passes)",
                results: "Nested variant of Dual CFG with reduced weights. Pretty decent video quality and resemblance, but introduces too much contrast on face. Clothing resemblance remains mediocre. The nested approach applies guidance differently but doesn't resolve the fundamental issues.",
                videoUrl: "assets/results1/WanPhantom_Test_00009.mp4"
            },
            {
                id: "00010",
                filename: "WanPhantom_Test_00010",
                condition: "Dual CFG, regular",
                cfg: "cond: 3.5, cond2_neg: 3.5",
                sampler: "euler, eta=0.0",
                speed: "Slowest (3 passes)",
                results: "Balanced equal weights for both guidance scales. Achieves very good video quality and resemblance to person and clothing. This is the best Dual CFG configuration tested, suggesting equal weights work better than the paper's asymmetric approach. However, still 30% slower than CondCombine with similar quality.",
                videoUrl: "assets/results1/WanPhantom_Test_00010.mp4"
            },
            {
                id: "00011",
                filename: "WanPhantom_Test_00011",
                condition: "Dual CFG, nested",
                cfg: "cond: 3.5, cond2_neg: 3.5",
                sampler: "euler, eta=0.0",
                speed: "Slowest (3 passes)",
                results: "Nested variant with balanced weights. Poor video quality with burned, high-contrast appearance. Extremely bad person resemblance with glowing blue eyes returning. Very mediocre clothing resemblance. Demonstrates that nested mode is problematic with higher guidance values.",
                videoUrl: "assets/results1/WanPhantom_Test_00011.mp4"
            },
            {
                id: "00012",
                filename: "WanPhantom_Test_00012",
                condition: "P: positive, N: negative_img_text",
                cfg: "cfg: 3.5",
                sampler: "euler, eta=0.0",
                speed: "Fast (2 passes)",
                results: "Standard CFG using the true unconditional negative (zeroed images). Very good video quality and resemblance to person and clothing. This is theoretically the most straightforward approach - full conditioning vs unconditional - and performs as well as if not better than CondCombine.",
                videoUrl: "assets/results1/WanPhantom_Test_00012.mp4"
            },
            {
                id: "00013",
                filename: "WanPhantom_Test_00013",
                condition: "P: positive, N: negative_img_text with standard negative text",
                cfg: "cfg: 3.5",
                sampler: "euler, eta=0.0",
                speed: "Fast (2 passes)",
                results: "Standard CFG with actual negative prompt text added (not just empty). Good video quality and resemblance. Adding negative text prompts provides additional control but doesn't significantly improve over test 00012.",
                videoUrl: "assets/results1/WanPhantom_Test_00013.mp4"
            }
        ];
        
        function createTestCard(test) {
            const videoHtml = test.videoUrl 
                ? `<video controls><source src="${test.videoUrl}" type="video/mp4"></video>`
                : `<div class="video-placeholder">Video: ${test.filename}.mp4</div>`;
            
            return `
                <div class="test-card" data-condition="${test.condition.toLowerCase()}" data-speed="${test.speed.toLowerCase()}">
                    <div class="test-header">
                        <span class="test-number">Test #${test.id}</span>
                        <span class="test-speed">${test.speed}</span>
                    </div>
                    <div class="test-details">
                        <div class="detail-item">
                            <div class="detail-label">Condition</div>
                            <div class="detail-value">${test.condition}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">CFG Settings</div>
                            <div class="detail-value">${test.cfg}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Sampler</div>
                            <div class="detail-value">${test.sampler}</div>
                        </div>
                    </div>
                    <div class="video-container">
                        ${videoHtml}
                    </div>
                    <div class="results-notes">
                        <strong>Notes:</strong> ${test.results}
                    </div>
                </div>
            `;
        }
        
        function renderTests() {
            const grid = document.getElementById('testGrid');
            grid.innerHTML = testData.map(test => createTestCard(test)).join('');
        }
        
        function filterTests(filter) {
            const cards = document.querySelectorAll('.test-card');
            const buttons = document.querySelectorAll('.filter-btn');
            
            // Update active button
            buttons.forEach(btn => {
                btn.classList.remove('active');
                if (btn.textContent.toLowerCase().includes(filter) || 
                    (filter === 'all' && btn.textContent === 'All Tests')) {
                    btn.classList.add('active');
                }
            });
            
            // Filter cards
            cards.forEach(card => {
                if (filter === 'all') {
                    card.style.display = 'block';
                } else if (filter === 'dual') {
                    card.style.display = card.dataset.condition.includes('dual') ? 'block' : 'none';
                } else if (filter === 'standard') {
                    card.style.display = !card.dataset.condition.includes('dual') ? 'block' : 'none';
                } else if (filter === 'fast') {
                    card.style.display = card.dataset.speed.includes('fast') ? 'block' : 'none';
                }
            });
        }
        
        // Initialize
        renderTests();
    </script>
</body>
</html>